#!/bin/bash

DOMAIN=$1

if [ -z "$DOMAIN" ]; then
  echo "Usage: $0 <domain>"
  exit 1
fi

# create the nginx config file
cp /etc/nginx/conf.d/domain.template /etc/nginx/conf.d/$DOMAIN.conf
sed -i "s/{domain}/$DOMAIN/g" /etc/nginx/conf.d/$DOMAIN.conf

certbot \
  --nginx \
  --non-interactive \
  --agree-tos \
  -m matthew.stephen.james@gmail.com \
  -d $DOMAIN

nginx -s reload
